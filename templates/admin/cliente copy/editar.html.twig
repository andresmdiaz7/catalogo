{% extends 'admin/base.html.twig' %}

{% block title %}Editar Cliente{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Editar Cliente</h1>
        <a href="{{ path('app_admin_cliente_index') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Volver al listado
        </a>
    </div>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}

    <div class="card">
        <div class="card-header bg-light">
            <h5 class="card-title mb-0">Datos del cliente</h5>
        </div>
        <div class="card-body">
            {{ form_start(form) }}
                <div class="row g-3">
                    <!-- Primera columna -->
                    <div class="col-md-4">
                        <div class="mb-3">
                            {{ form_label(form.codigo, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.codigo, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.codigo) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.razonSocial, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.razonSocial, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.razonSocial) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.cuit, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.cuit, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.cuit) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.direccion, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.direccion, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.direccion) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.telefono, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.telefono, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.telefono) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.email, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.email, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.email) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.web, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.web, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.web) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.porcentajeDescuento, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.porcentajeDescuento, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.porcentajeDescuento) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.rentabilidad, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.rentabilidad, {'attr': {'class': 'form-control form-control-sm'}}) }}
                            {{ form_errors(form.rentabilidad) }}
                        </div>
                    </div>
                    
                    <!-- Segunda columna -->
                    <div class="col-md-4">
                        <div class="mb-3">
                            {{ form_label(form.tipoCliente, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.tipoCliente, {'attr': {'class': 'form-select form-select-sm'}}) }}
                            {{ form_errors(form.tipoCliente) }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form_label(form.categoriaImpositiva, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.categoriaImpositiva, {'attr': {'class': 'form-select form-select-sm'}}) }}
                            {{ form_errors(form.categoriaImpositiva) }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form_label(form.localidad, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.localidad, {'attr': {'class': 'form-select form-select-sm'}}) }}
                            {{ form_errors(form.localidad) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.vendedor, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.vendedor, {'attr': {'class': 'form-select form-select-sm'}}) }}
                            {{ form_errors(form.vendedor) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.responsableLogistica, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.responsableLogistica, {'attr': {'class': 'form-select form-select-sm'}}) }}
                            {{ form_errors(form.responsableLogistica) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.categoria, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.categoria, {'attr': {'class': 'form-select form-select-sm'}}) }}
                            {{ form_errors(form.categoria) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.observaciones, null, {'label_attr': {'class': 'form-label small'}}) }}
                            {{ form_widget(form.observaciones, {'attr': {'class': 'form-control form-control-sm', 'rows': 3}}) }}
                            {{ form_errors(form.observaciones) }}
                        </div>
                        <div class="form-check mb-3">
                            {{ form_widget(form.habilitado, {'attr': {'class': 'form-check-input'}}) }}
                            {{ form_label(form.habilitado, null, {'label_attr': {'class': 'form-check-label'}}) }}
                        </div>
                        <div class="form-check mb-3">
                            {{ form_widget(form.habilitadoCuentaCorriente, {'attr': {'class': 'form-check-input'}}) }}
                            {{ form_label(form.habilitadoCuentaCorriente, null, {'label_attr': {'class': 'form-check-label'}}) }}
                        </div>
                    </div>
                    
                    <!-- Tercera columna -->
                    <div class="col-md-4">
                        <!-- Sección de usuario -->
                        <div class="card border-info mb-3">
                            <div class="card-header bg-info bg-opacity-10">
                                <h6 class="mb-0">Datos de acceso al sistema</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    {{ form_label(form.usuario, null, {'label_attr': {'class': 'form-label small'}}) }}
                                    {{ form_widget(form.usuario, {'attr': {'class': 'form-select form-select-sm'}}) }}
                                    {{ form_errors(form.usuario) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Guardar
                        </button>
                    </div>
                </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
{% if form.is_new is defined and form.is_new %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Código para manejar el toggle de creación de usuario
    const crearNuevoUsuarioCheckbox = document.querySelector('[name="cliente[crearNuevoUsuario]"]');
    const existingUserContainer = document.getElementById('existing-user-container');
    const newUserContainer = document.getElementById('new-user-container');
    
    crearNuevoUsuarioCheckbox.addEventListener('change', function() {
        if (this.checked) {
            existingUserContainer.style.display = 'none';
            newUserContainer.style.display = 'block';
            // Limpiar el selector de usuario existente
            document.querySelector('[name="cliente[usuario]"]').value = '';
        } else {
            existingUserContainer.style.display = 'block';
            newUserContainer.style.display = 'none';
            // Limpiar los campos de nuevo usuario
            document.querySelector('[name="cliente[nuevoUsuario][nombreReferencia]"]').value = '';
            document.querySelector('[name="cliente[nuevoUsuario][email]"]').value = '';
            document.querySelector('[name="cliente[nuevoUsuario][plainPassword]"]').value = '';
        }
    });

    // Auto-rellenar el email del nuevo usuario con el email del cliente
    const clienteEmailInput = document.querySelector('[name="cliente[email]"]');
    const nuevoUsuarioEmailInput = document.querySelector('[name="cliente[nuevoUsuario][email]"]');
    
    clienteEmailInput.addEventListener('change', function() {
        if (nuevoUsuarioEmailInput.value === '') {
            nuevoUsuarioEmailInput.value = this.value;
        }
    });

    // Auto-rellenar el nombre de referencia con la razón social del cliente
    const clienteRazonSocialInput = document.querySelector('[name="cliente[razonSocial]"]');
    const nuevoUsuarioNombreInput = document.querySelector('[name="cliente[nuevoUsuario][nombreReferencia]"]');
    
    clienteRazonSocialInput.addEventListener('change', function() {
        if (nuevoUsuarioNombreInput.value === '') {
            nuevoUsuarioNombreInput.value = this.value;
        }
    });
});
</script>
{% endif %}
{% endblock %}