{% extends 'admin/base.html.twig' %}

{% block title %}Editar Cliente{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Editar Cliente</h1>
        <a href="{{ path('app_admin_cliente_index') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Volver al listado
        </a>
    </div>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}

    <div class="card bg-body-tertiary shadow-lg">
        <div class="card-body">
            {{ form_start(form) }}
                <div class="row">
                    <div class="col-md-6">
                        {{ form_row(form.codigo) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.tipoCliente) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.razonSocial) }} 
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.categoriaImpositiva) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.cuit) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.categoria) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.localidad) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.porcentajeDescuento) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.direccion) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.rentabilidad) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.telefono) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.web) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.email) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.observaciones) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.vendedor) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.responsableLogistica) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.habilitado) }}
                    </div>
                    
                    <!-- Secci贸n de usuario con toggle -->
                    <div class="col-md-12 mt-4">
                        <div class="card border-info mb-3">
                            <div class="card-header bg-info bg-opacity-10">
                                <h6 class="mb-0">Datos de acceso al sistema</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    {{ form_widget(form.crearNuevoUsuario) }}
                                    {{ form_label(form.crearNuevoUsuario) }}
                                </div>
                                
                                <div id="existing-user-container">
                                    {{ form_label(form.usuario, null, {'label_attr': {'class': 'form-label small'}}) }}
                                    {{ form_widget(form.usuario, {'attr': {'class': 'form-select form-select-sm'}}) }}
                                    {{ form_errors(form.usuario) }}
                                </div>
                                
                                <div id="new-user-container" style="display: none;">
                                    <h6 class="mt-3 mb-2">Datos del nuevo usuario</h6>
                                    
                                    <div class="mb-3">
                                        {{ form_label(form.nuevoUsuario.nombreReferencia, null, {'label_attr': {'class': 'form-label small'}}) }}
                                        {{ form_widget(form.nuevoUsuario.nombreReferencia, {'attr': {'class': 'form-control form-control-sm'}}) }}
                                        {{ form_errors(form.nuevoUsuario.nombreReferencia) }}
                                    </div>
                                    
                                    <div class="mb-3">
                                        {{ form_label(form.nuevoUsuario.email, null, {'label_attr': {'class': 'form-label small'}}) }}
                                        {{ form_widget(form.nuevoUsuario.email, {'attr': {'class': 'form-control form-control-sm'}}) }}
                                        {{ form_errors(form.nuevoUsuario.email) }}
                                    </div>
                                    
                                    <div class="mb-3">
                                        {{ form_label(form.nuevoUsuario.plainPassword, null, {'label_attr': {'class': 'form-label small'}}) }}
                                        {{ form_widget(form.nuevoUsuario.plainPassword, {'attr': {'class': 'form-control form-control-sm'}}) }}
                                        {{ form_errors(form.nuevoUsuario.plainPassword) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // C贸digo para manejar el toggle de creaci贸n de usuario
    const crearNuevoUsuarioCheckbox = document.querySelector('[name="cliente[crearNuevoUsuario]"]');
    const existingUserContainer = document.getElementById('existing-user-container');
    const newUserContainer = document.getElementById('new-user-container');
    
    crearNuevoUsuarioCheckbox.addEventListener('change', function() {
        if (this.checked) {
            existingUserContainer.style.display = 'none';
            newUserContainer.style.display = 'block';
            // Limpiar el selector de usuario existente
            document.querySelector('[name="cliente[usuario]"]').value = '';
        } else {
            existingUserContainer.style.display = 'block';
            newUserContainer.style.display = 'none';
            // Limpiar los campos de nuevo usuario
            document.querySelector('[name="cliente[nuevoUsuario][nombreReferencia]"]').value = '';
            document.querySelector('[name="cliente[nuevoUsuario][email]"]').value = '';
            document.querySelector('[name="cliente[nuevoUsuario][plainPassword]"]').value = '';
        }
    });

    // Auto-rellenar el email del nuevo usuario con el email del cliente
    const clienteEmailInput = document.querySelector('[name="cliente[email]"]');
    const nuevoUsuarioEmailInput = document.querySelector('[name="cliente[nuevoUsuario][email]"]');
    
    clienteEmailInput.addEventListener('change', function() {
        if (nuevoUsuarioEmailInput.value === '') {
            nuevoUsuarioEmailInput.value = this.value;
        }
    });

    // Auto-rellenar el nombre de referencia con la raz贸n social del cliente
    const clienteRazonSocialInput = document.querySelector('[name="cliente[razonSocial]"]');
    const nuevoUsuarioNombreInput = document.querySelector('[name="cliente[nuevoUsuario][nombreReferencia]"]');
    
    clienteRazonSocialInput.addEventListener('change', function() {
        if (nuevoUsuarioNombreInput.value === '') {
            nuevoUsuarioNombreInput.value = this.value;
        }
    });
});
</script>
{% endblock %}